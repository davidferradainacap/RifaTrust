{% extends "base.html" %}
{% load humanize %}

{% block title %}Inicio - Sistema de Rifas{% endblock %}

{% block content %}
<!-- Hero Section -->
<div style="text-align: center; padding: 5rem 2rem 4rem; max-width: 800px; margin: 0 auto; position: relative; z-index: 10;">
    <h1 style="font-size: 2.75rem; font-weight: 700; margin-bottom: 1rem; color: white; line-height: 1.2; letter-spacing: -0.02em;">
        Sistema de Rifas en L√≠nea
    </h1>
    <p style="font-size: 1.1rem; color: rgba(255, 255, 255, 0.7); margin-bottom: 2rem; line-height: 1.6;">
        Participa en rifas seguras y transparentes. Organiza tus propias rifas o compra boletos para ganar incre√≠bles premios.
    </p>
    
    {% if not user.is_authenticated %}
    <div style="display: flex; gap: 1rem; justify-content: center; flex-wrap: wrap; position: relative; z-index: 10;">
        <a href="{% url 'register' %}" class="btn btn-primary" style="padding: 0.875rem 2rem; font-size: 1rem;">Crear Cuenta</a>
        <a href="{% url 'login' %}" class="btn btn-secondary" style="padding: 0.875rem 2rem; font-size: 1rem;">Iniciar Sesi√≥n</a>
    </div>
    {% else %}
    <a href="{% if user.rol == 'organizador' %}{% url 'raffles:organizer_dashboard' %}{% else %}{% url 'raffles:participant_dashboard' %}{% endif %}" class="btn btn-primary" style="padding: 0.875rem 2rem; font-size: 1rem;">
        Mi Dashboard
    </a>
    {% endif %}
</div>

<!-- Caracter√≠sticas -->
<div style="max-width: 1200px; margin: 3rem auto; padding: 0 2rem;">
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 1.5rem;">
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem; text-align: center;">
            <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: rgba(99, 102, 241, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.75rem;">
                üîí
            </div>
            <h3 style="font-size: 1.15rem; font-weight: 600; color: white; margin-bottom: 0.5rem;">Pagos Seguros</h3>
            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); line-height: 1.5;">Transacciones protegidas con encriptaci√≥n SSL</p>
        </div>
        
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem; text-align: center;">
            <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: rgba(99, 102, 241, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.75rem;">
                ‚úÖ
            </div>
            <h3 style="font-size: 1.15rem; font-weight: 600; color: white; margin-bottom: 0.5rem;">100% Transparente</h3>
            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); line-height: 1.5;">Todos los sorteos son verificables y p√∫blicos</p>
        </div>
        
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem; text-align: center;">
            <div style="width: 60px; height: 60px; margin: 0 auto 1rem; background: rgba(99, 102, 241, 0.15); border-radius: 12px; display: flex; align-items: center; justify-content: center; font-size: 1.75rem;">
                ‚ö°
            </div>
            <h3 style="font-size: 1.15rem; font-weight: 600; color: white; margin-bottom: 0.5rem;">R√°pido y F√°cil</h3>
            <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); line-height: 1.5;">Compra boletos en segundos desde cualquier lugar</p>
        </div>
    </div>
</div>

<!-- Rifas populares -->
{% if raffles %}
<div style="max-width: 1200px; margin: 5rem auto 3rem; padding: 0 2rem;">
    <div style="text-align: center; margin-bottom: 3rem;">
        <h2 style="font-size: 2rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">üî• Rifas Populares</h2>
        <p style="font-size: 0.95rem; color: rgba(255, 255, 255, 0.6);">Elige tu pr√≥xima oportunidad de ganar</p>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 1.5rem;">
        {% for raffle in raffles %}
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; overflow: hidden; transition: transform 0.2s, border-color 0.2s;" onmouseover="this.style.transform='translateY(-4px)'; this.style.borderColor='rgba(99, 102, 241, 0.3)'" onmouseout="this.style.transform='translateY(0)'; this.style.borderColor='rgba(99, 102, 241, 0.15)'">
            {% if raffle.imagen %}
            <div style="width: 100%; height: 200px; overflow: hidden;">
                <img src="{{ raffle.imagen.url }}" alt="{{ raffle.titulo }}" style="width: 100%; height: 100%; object-fit: cover;">
            </div>
            {% else %}
            <div style="width: 100%; height: 200px; background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); display: flex; align-items: center; justify-content: center; font-size: 3.5rem;">
                üéÅ
            </div>
            {% endif %}
            
            <div style="padding: 1.5rem;">
                <h3 style="font-size: 1.25rem; font-weight: 600; color: white; margin-bottom: 0.5rem; line-height: 1.3;">{{ raffle.titulo }}</h3>
                <p style="font-size: 0.9rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 1rem; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 2; line-clamp: 2; -webkit-box-orient: vertical; overflow: hidden;">{{ raffle.descripcion }}</p>
                
                <!-- Info adicional -->
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1rem;">
                    <div style="background: rgba(15, 23, 42, 0.6); border-radius: 8px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-bottom: 0.25rem;">Participantes</div>
                        <div style="font-size: 1.25rem; font-weight: 700; color: white;">{{ raffle.total_participantes }}</div>
                    </div>
                    <div style="background: rgba(15, 23, 42, 0.6); border-radius: 8px; padding: 0.75rem; text-align: center;">
                        <div style="font-size: 0.75rem; color: rgba(255, 255, 255, 0.5); margin-bottom: 0.25rem;">Boletos vendidos</div>
                        <div style="font-size: 1.05rem; font-weight: 700; color: var(--primary);">{{ raffle.boletos_vendidos }}/{{ raffle.total_boletos }}</div>
                    </div>
                </div>
                
                <div style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 1.25rem;">
                    <strong>Organizador:</strong> {{ raffle.organizador.nombre }}
                </div>
                
                <div style="margin-bottom: 1.25rem;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                        <span style="color: rgba(255, 255, 255, 0.5); font-size: 0.8rem; text-transform: uppercase; letter-spacing: 0.05em;">Progreso</span>
                        <span style="color: rgba(255, 255, 255, 0.8); font-size: 0.85rem; font-weight: 600;">
                            {{ raffle.boletos_vendidos }} / {{ raffle.total_boletos }}
                        </span>
                    </div>
                    <div style="height: 10px; background: rgba(15, 23, 42, 0.6); border-radius: 10px; overflow: hidden; border: 1px solid rgba(99, 102, 241, 0.15);">
                        <div class="progress-fill" data-width="{{ raffle.porcentaje_vendido }}" style="height: 100%; background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%); border-radius: 10px; transition: width 0.3s ease;"></div>
                    </div>
                </div>
                
                <div style="display: grid; gap: 0.75rem; padding-top: 1rem; border-top: 1px solid rgba(99, 102, 241, 0.15);">
                    <div style="display: flex; align-items: center; justify-content: space-between;">
                        <div style="font-size: 1.5rem; font-weight: 700; color: var(--primary);">CLP${{ raffle.precio_boleto|floatformat:0|intcomma }}</div>
                        <a href="/raffles/{{ raffle.id }}/" class="btn btn-primary" style="font-size: 0.9rem; padding: 0.6rem 1.25rem; text-decoration: none;">Ver Detalles</a>
                    </div>
                    {% if user.is_authenticated and user.rol == 'sponsor' %}
                    <a href="{% url 'raffles:create_sponsorship_request' raffle.id %}" 
                       class="btn" 
                       style="width: 100%; background: linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(99, 102, 241, 0.15)); 
                              border: 1px solid rgba(168, 85, 247, 0.3); color: #a855f7; 
                              padding: 0.6rem 1rem; font-size: 0.9rem; text-decoration: none; text-align: center; font-weight: 600;
                              transition: all 0.3s ease;"
                       onmouseover="this.style.background='linear-gradient(135deg, rgba(168, 85, 247, 0.25), rgba(99, 102, 241, 0.25))'; this.style.borderColor='rgba(168, 85, 247, 0.5)'"
                       onmouseout="this.style.background='linear-gradient(135deg, rgba(168, 85, 247, 0.15), rgba(99, 102, 241, 0.15))'; this.style.borderColor='rgba(168, 85, 247, 0.3)'">
                        ü§ù Solicitar Patrocinio
                    </a>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <div style="text-align: center; margin-top: 3rem;">
        <a href="/raffles/" class="btn btn-secondary" style="padding: 0.875rem 2rem; font-size: 0.95rem; text-decoration: none;">Ver Todas las Rifas</a>
    </div>
</div>
{% else %}
<div style="max-width: 600px; margin: 5rem auto; padding: 3rem 2rem; text-align: center;">
    <div style="font-size: 4rem; margin-bottom: 1rem;">üéÅ</div>
    <h3 style="font-size: 1.5rem; font-weight: 600; color: white; margin-bottom: 0.75rem;">No hay rifas activas</h3>
    <p style="font-size: 1rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 2rem;">Vuelve pronto para ver nuevas oportunidades de ganar incre√≠bles premios</p>
    {% if user.is_authenticated and user.rol == 'organizador' %}
    <a href="{% url 'raffles:create' %}" class="btn btn-primary" style="padding: 0.875rem 2rem; text-decoration: none;">Crear Mi Primera Rifa</a>
    {% endif %}
</div>
{% endif %}

<!-- CTA Final -->
{% if not user.is_authenticated %}
<div style="max-width: 800px; margin: 5rem auto 3rem; padding: 3rem 2rem; text-align: center; background: rgba(99, 102, 241, 0.1); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 16px;">
    <h2 style="font-size: 1.75rem; font-weight: 700; color: white; margin-bottom: 1rem;">¬øListo para comenzar?</h2>
    <p style="font-size: 1rem; color: rgba(255, 255, 255, 0.7); margin-bottom: 2rem;">√önete hoy y participa en rifas emocionantes</p>
    <a href="{% url 'register' %}" class="btn btn-primary" style="padding: 0.875rem 2.5rem; font-size: 1rem; text-decoration: none;">Registrarse Gratis</a>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.progress-fill').forEach(function(fill) {
        const width = fill.getAttribute('data-width');
        if (width) {
            fill.style.width = width + '%';
        }
    });
});
</script>
{% endblock %}
