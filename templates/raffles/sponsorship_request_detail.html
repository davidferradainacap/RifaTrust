{% extends 'base.html' %}
{% load static %}

{% block title %}Solicitud de Patrocinio{% endblock %}

{% block content %}
<div class="container" style="max-width: 1000px; margin: 2rem auto; padding: 0 1.5rem;">
    
    <!-- Header -->
    <div style="margin-bottom: 2rem;">
        <a href="{% if user == solicitud.sponsor %}{% url 'raffles:sponsor_dashboard' %}{% else %}{% url 'raffles:organizer_dashboard' %}{% endif %}" 
           style="display: inline-flex; align-items: center; gap: 0.5rem; color: var(--primary); text-decoration: none; margin-bottom: 1rem; font-size: 0.95rem;">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
            Volver al dashboard
        </a>
        
        <div style="display: flex; justify-content: space-between; align-items: start; flex-wrap: wrap; gap: 1rem;">
            <div>
                <h1 style="font-size: 2rem; font-weight: 700; color: white; margin-bottom: 0.5rem;">
                    ü§ù Solicitud de Patrocinio
                </h1>
                <p style="font-size: 1.05rem; color: rgba(255, 255, 255, 0.6);">
                    {{ solicitud.nombre_marca }} ‚Üí {{ solicitud.rifa.titulo }}
                </p>
            </div>
            
            <!-- Estado Badge -->
            <div>
                {% if solicitud.estado == 'pendiente' %}
                <span style="display: inline-block; padding: 0.5rem 1rem; background: rgba(251, 191, 36, 0.2); border: 1px solid rgba(251, 191, 36, 0.5); border-radius: 8px; color: #fbbf24; font-size: 0.9rem; font-weight: 600;">
                    ‚è≥ Pendiente
                </span>
                {% elif solicitud.estado == 'aceptada' %}
                <span style="display: inline-block; padding: 0.5rem 1rem; background: rgba(34, 197, 94, 0.2); border: 1px solid rgba(34, 197, 94, 0.5); border-radius: 8px; color: #22c55e; font-size: 0.9rem; font-weight: 600;">
                    ‚úÖ Aceptada
                </span>
                {% elif solicitud.estado == 'rechazada' %}
                <span style="display: inline-block; padding: 0.5rem 1rem; background: rgba(239, 68, 68, 0.2); border: 1px solid rgba(239, 68, 68, 0.5); border-radius: 8px; color: #ef4444; font-size: 0.9rem; font-weight: 600;">
                    ‚ùå Rechazada
                </span>
                {% endif %}
            </div>
        </div>
    </div>

    <div style="display: grid; gap: 2rem;">
        
        <!-- Informaci√≥n de la Rifa -->
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem;">
            <h2 style="font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 1.5rem;">üìã Rifa Objetivo</h2>
            <div style="display: flex; gap: 1.5rem; align-items: start;">
                {% if solicitud.rifa.imagen %}
                <img src="{{ solicitud.rifa.imagen.url }}" alt="{{ solicitud.rifa.titulo }}" 
                     style="width: 150px; height: 150px; object-fit: cover; border-radius: 12px;">
                {% endif %}
                <div style="flex: 1;">
                    <h3 style="font-size: 1.2rem; font-weight: 600; color: white; margin-bottom: 0.75rem;">
                        <a href="{% url 'raffles:detail' solicitud.rifa.id %}" style="color: var(--primary); text-decoration: none;">
                            {{ solicitud.rifa.titulo }}
                        </a>
                    </h3>
                    <div style="display: grid; gap: 0.5rem; font-size: 0.95rem;">
                        <p style="color: rgba(255, 255, 255, 0.7);">
                            <strong style="color: rgba(255, 255, 255, 0.9);">Organizador:</strong> {{ solicitud.rifa.organizador.nombre }}
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.7);">
                            <strong style="color: rgba(255, 255, 255, 0.9);">Premio Principal:</strong> {{ solicitud.rifa.premio_principal }}
                        </p>
                        <p style="color: rgba(255, 255, 255, 0.7);">
                            <strong style="color: rgba(255, 255, 255, 0.9);">Fecha Sorteo:</strong> {{ solicitud.rifa.fecha_sorteo|date:"d/m/Y H:i" }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Premio Adicional del Sponsor -->
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem;">
            <h2 style="font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 1.5rem;">üéÅ Premio Adicional Propuesto</h2>
            <div style="display: grid; gap: 2rem;">
                {% if solicitud.imagen_premio %}
                <div style="text-align: center;">
                    <img src="{{ solicitud.imagen_premio.url }}" alt="{{ solicitud.nombre_premio_adicional }}" 
                         style="max-width: 100%; max-height: 300px; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.3);">
                </div>
                {% endif %}
                
                <div>
                    <h3 style="font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 0.75rem;">
                        {{ solicitud.nombre_premio_adicional }}
                    </h3>
                    <p style="font-size: 1.1rem; color: var(--primary); font-weight: 600; margin-bottom: 1rem;">
                        Valor: CLP${{ solicitud.valor_premio|floatformat:0 }}
                    </p>
                    <p style="font-size: 0.95rem; color: rgba(255, 255, 255, 0.8); line-height: 1.6;">
                        {{ solicitud.descripcion_premio }}
                    </p>
                </div>
            </div>
        </div>

        <!-- Informaci√≥n de la Marca -->
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem;">
            <h2 style="font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 1.5rem;">üè¢ Informaci√≥n del Sponsor</h2>
            <div style="display: flex; gap: 2rem; align-items: start;">
                {% if solicitud.logo_marca %}
                <div style="min-width: 120px;">
                    <img src="{{ solicitud.logo_marca.url }}" alt="{{ solicitud.nombre_marca }}" 
                         style="width: 120px; height: 120px; object-fit: contain; background: white; border-radius: 12px; padding: 0.75rem;">
                </div>
                {% endif %}
                <div style="flex: 1;">
                    <h3 style="font-size: 1.2rem; font-weight: 600; color: white; margin-bottom: 1rem;">
                        {{ solicitud.nombre_marca }}
                    </h3>
                    <div style="display: grid; gap: 0.75rem; margin-bottom: 1.5rem;">
                        <p style="font-size: 0.95rem; color: rgba(255, 255, 255, 0.7);">
                            <strong style="color: rgba(255, 255, 255, 0.9);">Contacto:</strong> {{ solicitud.sponsor.nombre }} ({{ solicitud.sponsor.email }})
                        </p>
                        {% if solicitud.sitio_web %}
                        <p style="font-size: 0.95rem; color: rgba(255, 255, 255, 0.7);">
                            <strong style="color: rgba(255, 255, 255, 0.9);">Sitio Web:</strong> 
                            <a href="{{ solicitud.sitio_web }}" target="_blank" style="color: var(--primary); text-decoration: none;">
                                {{ solicitud.sitio_web }}
                            </a>
                        </p>
                        {% endif %}
                    </div>
                    
                    <div style="background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.2); border-radius: 10px; padding: 1.5rem;">
                        <h4 style="font-size: 1rem; font-weight: 600; color: white; margin-bottom: 0.75rem;">üí¨ Mensaje de Patrocinio</h4>
                        <p style="font-size: 0.95rem; color: rgba(255, 255, 255, 0.8); line-height: 1.6; white-space: pre-line;">{{ solicitud.mensaje_patrocinio }}</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Detalles de la Solicitud -->
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem;">
            <h2 style="font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 1.5rem;">üìä Detalles de la Solicitud</h2>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1.5rem;">
                <div>
                    <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Fecha de Solicitud</p>
                    <p style="font-size: 1rem; color: white; font-weight: 600;">{{ solicitud.fecha_solicitud|date:"d/m/Y H:i" }}</p>
                </div>
                {% if solicitud.fecha_respuesta %}
                <div>
                    <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Fecha de Respuesta</p>
                    <p style="font-size: 1rem; color: white; font-weight: 600;">{{ solicitud.fecha_respuesta|date:"d/m/Y H:i" }}</p>
                </div>
                {% endif %}
                <div>
                    <p style="font-size: 0.85rem; color: rgba(255, 255, 255, 0.6); margin-bottom: 0.25rem;">Estado</p>
                    <p style="font-size: 1rem; color: white; font-weight: 600;">{{ solicitud.get_estado_display }}</p>
                </div>
            </div>

            {% if solicitud.estado == 'rechazada' and solicitud.motivo_rechazo %}
            <div style="margin-top: 1.5rem; background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 10px; padding: 1.5rem;">
                <h4 style="font-size: 1rem; font-weight: 600; color: #ef4444; margin-bottom: 0.75rem;">‚ùå Motivo de Rechazo</h4>
                <p style="font-size: 0.95rem; color: rgba(255, 255, 255, 0.8); line-height: 1.6;">{{ solicitud.motivo_rechazo }}</p>
            </div>
            {% endif %}
        </div>

        <!-- Acciones (solo para organizador) -->
        {% if user == solicitud.rifa.organizador and solicitud.estado == 'pendiente' %}
        <div style="background: rgba(30, 41, 59, 0.4); border: 1px solid rgba(99, 102, 241, 0.15); border-radius: 14px; padding: 2rem;">
            <h2 style="font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 1.5rem;">‚ö° Acciones</h2>
            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                <form method="post" action="{% url 'raffles:accept_sponsorship' solicitud.id %}" style="flex: 1;">
                    {% csrf_token %}
                    <button type="submit" class="btn btn-primary" style="width: 100%; padding: 0.75rem 1.5rem;" 
                            onclick="return confirm('¬øEst√°s seguro de aceptar este patrocinio?');">
                        ‚úÖ Aceptar Patrocinio
                    </button>
                </form>
                
                <button onclick="document.getElementById('reject-modal').style.display='flex'" 
                        class="btn btn-secondary" style="flex: 1; padding: 0.75rem 1.5rem;">
                    ‚ùå Rechazar Solicitud
                </button>
            </div>
        </div>

        <!-- Modal de Rechazo -->
        <div id="reject-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); align-items: center; justify-content: center; z-index: 9999;">
            <div style="background: rgba(15, 23, 42, 0.95); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 14px; padding: 2rem; max-width: 500px; width: 90%;">
                <h3 style="font-size: 1.3rem; font-weight: 600; color: white; margin-bottom: 1rem;">Rechazar Solicitud</h3>
                <form method="post" action="{% url 'raffles:reject_sponsorship' solicitud.id %}">
                    {% csrf_token %}
                    <div style="margin-bottom: 1.5rem;">
                        <label style="display: block; font-size: 0.9rem; font-weight: 500; color: rgba(255, 255, 255, 0.9); margin-bottom: 0.5rem;">
                            Motivo del Rechazo
                        </label>
                        <textarea name="motivo_rechazo" rows="4" required
                                  style="width: 100%; padding: 0.75rem 1rem; background: rgba(15, 23, 42, 0.6); border: 1px solid rgba(99, 102, 241, 0.3); border-radius: 8px; color: white; font-size: 0.95rem; resize: vertical;"></textarea>
                    </div>
                    <div style="display: flex; gap: 1rem; justify-content: flex-end;">
                        <button type="button" onclick="document.getElementById('reject-modal').style.display='none'" 
                                class="btn btn-secondary" style="padding: 0.75rem 1.5rem;">
                            Cancelar
                        </button>
                        <button type="submit" class="btn btn-primary" style="padding: 0.75rem 1.5rem; background: #ef4444;">
                            Confirmar Rechazo
                        </button>
                    </div>
                </form>
            </div>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}
