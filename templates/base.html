<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="RifaTrust - Sistema de Rifas Seguro y Transparente">
    <title>{% block title %}Sistema de Rifas{% endblock %}</title>
    <link rel="stylesheet" href="/static/css/styles.css">
    <link rel="stylesheet" href="/static/css/raffle_glass.css">
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Navegaci√≥n -->
    <nav class="navbar">
        <div class="container">
            <a href="/" class="logo">
                üéüÔ∏è Sistema de Rifas
            </a>
            
            <div class="nav-links">
                <a href="/">Inicio</a>
                <a href="/raffles/">Rifas</a>
                
                {% if user.is_authenticated %}
                    <a href="/dashboard/">Dashboard</a>
                    {% if user.rol == 'organizador' or user.rol == 'admin' %}
                        <a href="/raffles/create/">Crear Rifa</a>
                    {% endif %}
                    <a href="/notifications/" style="position: relative; display: inline-flex; align-items: center; gap: 0.25rem;">
                        <span style="font-size: 1.2rem;">üîî</span>
                        <span id="notificationBadge" style="display: none; position: absolute; top: -5px; right: -8px; background: #ef4444; color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 0.7rem; font-weight: bold; display: flex; align-items: center; justify-content: center;"></span>
                    </a>
                    <a href="/profile/">{{ user.nombre }}</a>
                    <a href="/logout/" class="btn-secondary btn-sm">Cerrar Sesi√≥n</a>
                {% else %}
                    <a href="/login/" class="btn-secondary btn-sm">Iniciar Sesi√≥n</a>
                    <a href="/register/" class="btn-primary btn-sm">Registrarse</a>
                {% endif %}
            </div>
        </div>
    </nav>

    <!-- Contenido principal -->
    <main class="main-content">
        <div class="container">
            <!-- Mensajes -->
            {% if messages %}
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">
                        {{ message }}
                    </div>
                {% endfor %}
            {% endif %}

            {% block content %}{% endblock %}
        </div>
    </main>

    <!-- Footer -->
    <footer style="background: rgba(15, 23, 42, 0.95); backdrop-filter: blur(20px); border-top: 1px solid rgba(99, 102, 241, 0.2); padding: 2.5rem 0; margin-top: 4rem;">
        <div class="container text-center">
            <p style="color: white; font-weight: 600; font-size: 1rem;">&copy; 2025 Sistema de Rifas. Todos los derechos reservados.</p>
            <p style="margin-top: 0.75rem; color: rgba(255, 255, 255, 0.6); font-size: 0.95rem;">
                üîí Seguro ‚Ä¢ ‚úÖ Transparente ‚Ä¢ ‚ö° Confiable
            </p>
        </div>
    </footer>

    <script src="/static/js/main.js"></script>
    
    {% if user.is_authenticated %}
    <script>
        // Cargar contador de notificaciones no le√≠das
        function updateNotificationBadge() {
            fetch('/notifications/count/')
                .then(response => response.json())
                .then(data => {
                    const badge = document.getElementById('notificationBadge');
                    if (data.unread_count > 0) {
                        badge.textContent = data.unread_count > 9 ? '9+' : data.unread_count;
                        badge.style.display = 'flex';
                    } else {
                        badge.style.display = 'none';
                    }
                })
                .catch(error => console.error('Error al cargar notificaciones:', error));
        }
        
        // Actualizar al cargar la p√°gina
        updateNotificationBadge();
        
        // Actualizar cada 30 segundos
        setInterval(updateNotificationBadge, 30000);
    </script>
    {% endif %}
    
    {% block extra_js %}{% endblock %}
</body>
</html>
